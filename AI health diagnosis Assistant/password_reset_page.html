<!DOCTYPE html>
<html class="h-full" lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>
   Password Reset | AI Health Assistant
  </title>
  <!-- Poppins Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;300;400;500;600;700&amp;display=swap" rel="stylesheet"/>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com">
  </script>
  <script>
   tailwind.config = {
    theme: {
        extend: {
            fontFamily: {
                sans: ['Poppins', 'ui-sans-serif', 'system-ui']
            }
        }
    }
}
  </script>
  <!-- Font Awesome 6 -->
  <link crossorigin="anonymous" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" referrerpolicy="no-referrer" rel="stylesheet"/>
  <!-- SweetAlert2 -->
  <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js">
  </script>
  <!-- ApexCharts (included globally for consistency; not used on this page) -->
  <script src="https://cdn.jsdelivr.net/npm/apexcharts">
  </script>
  <!-- Site Theme CSS -->
  <link href="style.css" rel="stylesheet"/>
  <!-- Page-specific CSS (can be moved to password_reset_page.css) -->
  <style>
   /* Accessible mode: increase base font size and contrast adjustments */
    .accessible-mode body, .accessible-mode .page-root { font-size: 20px; line-height: 1.7; }
    .accessible-mode .card { box-shadow: 0 0 0 3px rgba(0,0,0,0.08); }
    .focus-ring:focus { outline: 3px solid rgba(0,0,255,0.35); outline-offset: 2px; }
    /* Slide panels */
    .slide-in-right { transform: translateX(100%); transition: transform 250ms ease; }
    .slide-in-right.active { transform: translateX(0%); }
    .slide-up { transform: translateY(16px); opacity: 0; transition: all 220ms ease; }
    .slide-up.active { transform: translateY(0); opacity: 1; }
  </style>
 
<!-- CSS Loader Script -->
<script src="./css_loader.js"></script>
</head>
 <body class="min-h-full bg-gray-50 text-gray-800 font-sans">
  <!-- Common Auth Header -->
  <header class="fixed top-0 left-0 right-0 z-50 w-full bg-[#0000FF] text-white shadow-md" id="app-header">
   <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-16">
     <a class="flex items-center gap-2" href="./home_page.html">
      <span class="inline-flex h-8 w-8 rounded-full bg-white/20 items-center justify-center">
       <i class="fa-solid fa-heart-pulse">
       </i>
      </span>
      <span class="font-semibold">
       AI Health Assistant
      </span>
     </a>
     <div class="hidden md:flex items-center gap-4">
      <a class="px-3 py-2 rounded-md bg-white/20 hover:bg-white/30" href="./home_page.html">
       Back to Home
      </a>
      <a class="flex items-center gap-2 px-3 py-2 rounded-md bg-[#008080] hover:bg-[#008080]/80" href="./about_page.html">
       <i class="fa-regular fa-question-circle">
       </i>
       <span>
        Support
       </span>
      </a>
     </div>
     <button class="md:hidden inline-flex items-center gap-2 px-3 py-2 rounded-md bg-white/20" id="sidebarToggle">
      Menu
     </button>
    </div>
   </div>
   <script>
    (function() {
    const btn = document.getElementById('sidebarToggle');
    const sb = document.getElementById('app-sidebar');
    if (btn && sb) {
        btn.addEventListener('click', () => sb.classList.toggle('hidden'));
    }
})();
   </script>
  </header>
  <!-- Main Content -->
  <main class="page-root pt-20 pb-24">
   <section class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Page Intro / Breadcrumb-like line -->
    <div class="flex items-center justify-between mb-6">
     <div class="flex items-center gap-3">
      <div class="h-10 w-10 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center">
       <i class="fa-solid fa-key">
       </i>
      </div>
      <div>
       <h1 class="text-2xl font-semibold text-gray-900">
        Reset your password
       </h1>
       <p class="text-gray-600 text-base">
        Secure, two-step process to help you get back in.
       </p>
      </div>
     </div>
     <!-- Accessibility toggle -->
     <button aria-pressed="false" class="focus-ring inline-flex items-center gap-2 px-3 py-2 rounded-md border border-gray-200 bg-white text-gray-800 hover:bg-gray-50" id="accessToggle" title="Toggle accessibility mode">
      <i class="fa-solid fa-universal-access text-[#008080]">
      </i>
      <span class="hidden sm:inline">
       Accessibility
      </span>
     </button>
    </div>
    <!-- Card Container -->
    <div class="card rounded-xl shadow-sm border border-gray-200 overflow-hidden bg-white">
     <div class="card-header px-6 py-4 border-b bg-gray-50">
      <div class="flex items-center justify-between">
       <div class="flex items-center gap-3">
        <i class="fa-solid fa-shield-halved text-[#008080]">
        </i>
        <span class="font-medium text-gray-800">
         Password Reset Manager
        </span>
       </div>
       <!-- Narrate instructions -->
       <button class="focus-ring inline-flex items-center gap-2 px-3 py-1.5 rounded-md bg-blue-600 text-white hover:bg-blue-700 text-sm" id="narrateBtn">
        <i class="fa-solid fa-headphones">
        </i>
        <span class="hidden sm:inline">
         Narrate
        </span>
       </button>
      </div>
     </div>
     <!-- Notification area -->
     <div aria-live="polite" class="px-6 pt-4 hidden" id="notificationArea">
     </div>
     <div class="px-6 pb-6 pt-4 grid md:grid-cols-5 gap-6">
      <!-- Illustration (hidden on very small screens) -->
      <div class="md:col-span-2 hidden md:flex items-start justify-center">
       <img alt="Secure password reset illustration" class="rounded-lg shadow-sm w-full h-auto object-cover" onerror="this.onerror=null;this.src='https://picsum.photos/seed/security/400/400';" src="https://picsum.photos/id/433/400/400"/>
      </div>
      <!-- Forms Column -->
      <div class="md:col-span-3">
       <!-- Steps indicator -->
       <div aria-label="Password reset steps" class="flex items-center gap-3 mb-5">
        <div class="flex items-center gap-2">
         <span class="h-2.5 w-2.5 rounded-full bg-blue-600" id="step1Dot">
         </span>
         <span class="text-sm text-gray-700">
          Request Link
         </span>
        </div>
        <i class="fa-solid fa-angles-right text-gray-400">
        </i>
        <div class="flex items-center gap-2">
         <span class="h-2.5 w-2.5 rounded-full bg-gray-300" id="step2Dot">
         </span>
         <span class="text-sm text-gray-700">
          Set New Password
         </span>
        </div>
       </div>
       <!-- Request Reset Form -->
       <form class="space-y-4" id="requestForm" novalidate="">
        <div>
         <label class="block text-gray-800 font-medium" for="email">
          Email address
         </label>
         <div class="mt-1 relative">
          <input aria-describedby="emailHelp" autocomplete="email" class="form-input focus-ring w-full rounded-lg border border-gray-300 px-4 py-3 text-gray-900 placeholder-gray-400" id="email" inputmode="email" placeholder="Enter your email address" required="" type="email"/>
          <div class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400" title="Enter the email you used to register">
           <i class="fa-regular fa-circle-question">
           </i>
          </div>
         </div>
         <p class="text-sm text-gray-600 mt-1" id="emailHelp">
          We'll email you a secure link to reset your password.
         </p>
        </div>
        <div class="flex items-center justify-between">
         <a class="text-blue-600 hover:text-blue-700 inline-flex items-center gap-2" href="./login_page.html">
          <i class="fa-solid fa-arrow-left">
          </i>
          <span>
           Back to Login
          </span>
         </a>
         <button class="btn-primary inline-flex items-center gap-2 px-5 py-2.5 rounded-lg disabled:opacity-60 disabled:cursor-not-allowed" id="sendLinkBtn" type="submit">
          <span class="btn-label">
           Send Reset Link
          </span>
          <span class="hidden spinner">
           <i class="fa-solid fa-circle-notch fa-spin">
           </i>
          </span>
         </button>
        </div>
       </form>
       <!-- Set New Password Form -->
       <form class="space-y-4 hidden" id="resetForm" novalidate="">
        <div class="bg-blue-50 border border-blue-200 text-blue-800 px-4 py-3 rounded-lg text-sm">
         <i class="fa-solid fa-info-circle mr-2">
         </i>
         Enter a strong password and confirm it. Your link is securely validated.
        </div>
        <div>
         <label class="block text-gray-800 font-medium" for="newPassword">
          New password
         </label>
         <div class="mt-1 relative">
          <input aria-describedby="pwdHelp" autocomplete="new-password" class="form-input focus-ring w-full rounded-lg border border-gray-300 px-4 py-3 text-gray-900 placeholder-gray-400" id="newPassword" placeholder="Enter new password" required="" type="password"/>
          <button aria-label="Show or hide password" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500" id="toggleNewPwd" title="Show/Hide password" type="button">
           <i class="fa-regular fa-eye">
           </i>
          </button>
         </div>
         <p class="text-sm text-gray-600 mt-2" id="pwdHelp">
          Must be 8+ characters, include uppercase, number, and special character.
         </p>
         <div aria-hidden="true" class="mt-2 h-2 w-full bg-gray-200 rounded-full overflow-hidden">
          <div class="h-2 w-1/12 bg-red-500" id="strengthBar">
          </div>
         </div>
        </div>
        <div>
         <label class="block text-gray-800 font-medium" for="confirmPassword">
          Confirm new password
         </label>
         <div class="mt-1 relative">
          <input autocomplete="new-password" class="form-input focus-ring w-full rounded-lg border border-gray-300 px-4 py-3 text-gray-900 placeholder-gray-400" id="confirmPassword" placeholder="Confirm new password" required="" type="password"/>
          <button aria-label="Show or hide password" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500" id="toggleConfirmPwd" title="Show/Hide password" type="button">
           <i class="fa-regular fa-eye">
           </i>
          </button>
         </div>
         <p class="text-sm mt-1" id="matchText">
         </p>
        </div>
        <div class="flex items-center justify-between">
         <a class="text-blue-600 hover:text-blue-700 inline-flex items-center gap-2" href="./login_page.html">
          <i class="fa-solid fa-right-to-bracket">
          </i>
          <span>
           Go to Login
          </span>
         </a>
         <button class="btn-success inline-flex items-center gap-2 px-5 py-2.5 rounded-lg disabled:opacity-60 disabled:cursor-not-allowed" id="resetPwdBtn" type="submit">
          <span class="btn-label">
           Reset Password
          </span>
          <span class="hidden spinner">
           <i class="fa-solid fa-circle-notch fa-spin">
           </i>
          </span>
         </button>
        </div>
       </form>
       <!-- Mini coach mark -->
       <div class="mt-6 p-3 rounded-lg bg-yellow-50 border border-yellow-200 text-yellow-800 text-sm flex items-start gap-3">
        <i class="fa-solid fa-lightbulb text-yellow-600 mt-0.5">
        </i>
        <p>
         <strong>
          Tip:
         </strong>
         If you don't see the email within a few minutes, check your spam folder or use a different email address.
        </p>
       </div>
      </div>
     </div>
     <div class="card-footer px-6 py-4 border-t bg-gray-50 text-sm text-gray-600">
      Need more help? Visit
      <a class="text-blue-600 hover:text-blue-700" href="./about_page.html">
       Support
      </a>
      or contact us.
     </div>
    </div>
   </section>
  </main>
  <!-- Floating Notification Panel Trigger -->
  <button aria-expanded="false" class="fixed right-4 bottom-28 z-40 inline-flex items-center justify-center h-12 w-12 rounded-full shadow-md bg-white border border-gray-200 text-gray-700 hover:bg-gray-50" id="notifyToggle" title="Notifications">
   <i class="fa-regular fa-bell">
   </i>
  </button>
  <!-- Notification Panel -->
  <aside class="fixed right-0 bottom-0 top-16 w-80 bg-white border-l border-gray-200 shadow-xl slide-in-right z-40" id="notifyPanel">
   <div class="p-4 border-b bg-gray-50 flex items-center justify-between">
    <div class="flex items-center gap-2">
     <i class="fa-regular fa-bell text-[#008080]">
     </i>
     <span class="font-medium text-gray-800">
      Notifications
     </span>
    </div>
    <button aria-label="Close notifications" class="text-gray-500 hover:text-gray-700" id="closeNotify">
     <i class="fa-solid fa-xmark">
     </i>
    </button>
   </div>
   <div class="p-4 space-y-3 overflow-y-auto h-[calc(100vh-64px-56px)]">
    <div class="alert-info rounded-lg border p-3 text-sm">
     <i class="fa-solid fa-circle-info mr-2">
     </i>
     Tip: Use a unique password you haven't used elsewhere.
    </div>
    <div class="alert-warning rounded-lg border p-3 text-sm">
     <i class="fa-solid fa-triangle-exclamation mr-2">
     </i>
     Don't share your reset link with anyone.
    </div>
    <div class="alert-success rounded-lg border p-3 text-sm">
     <i class="fa-solid fa-check mr-2">
     </i>
     System operational. No incidents reported.
    </div>
    <div class="alert-danger rounded-lg border p-3 text-sm">
     <i class="fa-solid fa-circle-exclamation mr-2">
     </i>
     If your token expired, request a new reset link.
    </div>
   </div>
  </aside>
  <!-- Help Assistant Floating -->
  <button aria-expanded="false" class="fixed right-4 bottom-12 z-40 inline-flex items-center justify-center h-12 w-12 rounded-full shadow-md bg-[#008080] text-white hover:bg-[#008080]/90" id="helpToggle" title="Help Assistant">
   <i class="fa-regular fa-circle-question">
   </i>
  </button>
  <div class="fixed right-4 bottom-28 w-80 bg-white border border-gray-200 rounded-xl shadow-xl p-4 slide-up z-40" id="helpPanel">
   <div class="flex items-start gap-3">
    <div class="h-10 w-10 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center">
     <i class="fa-solid fa-robot">
     </i>
    </div>
    <div class="flex-1">
     <p class="font-medium text-gray-800">
      Need some help?
     </p>
     <p class="text-sm text-gray-600">
      I can guide you through requesting a link or setting a new password.
     </p>
     <div class="mt-3 flex flex-wrap gap-2">
      <button class="px-3 py-1.5 text-sm rounded-md border border-gray-200 hover:bg-gray-50" onclick="window.scrollTo({top:0, behavior:'smooth'})">
       How to reset
      </button>
      <a class="px-3 py-1.5 text-sm rounded-md bg-blue-600 text-white hover:bg-blue-700" href="./about_page.html">
       Contact Support
      </a>
     </div>
    </div>
   </div>
  </div>
  <!-- Common Auth Footer -->
  <footer class="bg-gray-100 text-gray-700 border-t border-gray-200">
   <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 flex flex-col md:flex-row items-center justify-between gap-4">
    <div class="flex items-center gap-2">
     <span class="inline-flex h-6 w-6 rounded bg-[#0000FF]/10 items-center justify-center text-[#0000FF]">
      <i class="fa-solid fa-heart-pulse">
      </i>
     </span>
     <span class="text-sm">
      Â© 2025 AI-Health Corp.
     </span>
    </div>
    <div class="flex items-center gap-6">
     <a class="hover:text-[#0000FF]" href="./terms_of_service_page.html">
      Terms
     </a>
     <a class="hover:text-[#0000FF]" href="./privacy_policy_page.html">
      Privacy
     </a>
    </div>
   </div>
  </footer>
  <script>
   // Utility: Query params
function getQueryParams() {
    const params = new URLSearchParams(window.location.search);
    return Object.fromEntries(params.entries());
}

// Elements
const requestForm = document.getElementById('requestForm');
const resetForm = document.getElementById('resetForm');
const notificationArea = document.getElementById('notificationArea');
const step1Dot = document.getElementById('step1Dot');
const step2Dot = document.getElementById('step2Dot');

const emailInput = document.getElementById('email');
const sendLinkBtn = document.getElementById('sendLinkBtn');

const newPassword = document.getElementById('newPassword');
const confirmPassword = document.getElementById('confirmPassword');
const resetPwdBtn = document.getElementById('resetPwdBtn');
const matchText = document.getElementById('matchText');
const strengthBar = document.getElementById('strengthBar');

const toggleNewPwd = document.getElementById('toggleNewPwd');
const toggleConfirmPwd = document.getElementById('toggleConfirmPwd');

const helpToggle = document.getElementById('helpToggle');
const helpPanel = document.getElementById('helpPanel');

const notifyToggle = document.getElementById('notifyToggle');
const notifyPanel = document.getElementById('notifyPanel');
const closeNotify = document.getElementById('closeNotify');

const accessToggle = document.getElementById('accessToggle');
const narrateBtn = document.getElementById('narrateBtn');

// State
let isLoading = false;
let currentView = 'request';
let resetToken = null;

function setLoading(buttonEl, loading) {
    const label = buttonEl.querySelector('.btn-label');
    const spinner = buttonEl.querySelector('.spinner');
    if (loading) {
        buttonEl.setAttribute('disabled', 'true');
        if (label) label.classList.add('hidden');
        if (spinner) spinner.classList.remove('hidden');
    } else {
        buttonEl.removeAttribute('disabled');
        if (label) label.classList.remove('hidden');
        if (spinner) spinner.classList.add('hidden');
    }
}

function showNotification(message, type) {
    // type: 'success' | 'error' | 'info' | 'warning'
    const map = {
        success: 'alert-success',
        error: 'alert-danger',
        info: 'alert-info',
        warning: 'alert-warning'
    };
    notificationArea.innerHTML = `<div class="${map[type] || 'alert-info'} rounded-lg border p-3 flex items-start gap-2"><i class="fa-solid ${type==='success'?'fa-check-circle': type==='error'?'fa-circle-exclamation': type==='warning'?'fa-triangle-exclamation':'fa-circle-info'} mt-0.5"></i><span>${message}</span></div>`;
    notificationArea.classList.remove('hidden');
}

function clearNotification() {
    notificationArea.classList.add('hidden');
    notificationArea.innerHTML = '';
}

function validateEmail(email) {
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
}

function passwordComplexityScore(pwd) {
    let score = 0;
    if (pwd.length >= 8) score++;
    if (/[A-Z]/.test(pwd)) score++;
    if (/[0-9]/.test(pwd)) score++;
    if (/[^A-Za-z0-9]/.test(pwd)) score++;
    if (pwd.length >= 12) score++; // bonus
    return score; // 0-5
}

function updateStrengthBar(score) {
    const widths = ['0%', '20%', '40%', '60%', '80%', '100%'];
    const colors = ['bg-red-500', 'bg-red-500', 'bg-orange-500', 'bg-yellow-500', 'bg-green-500', 'bg-green-600'];
    strengthBar.className = `h-2 ${colors[score]} transition-all duration-200`;
    strengthBar.style.width = widths[score];
}

function setView(view) {
    currentView = view;
    if (view === 'request') {
        requestForm.classList.remove('hidden');
        resetForm.classList.add('hidden');
        step1Dot.classList.replace('bg-gray-300', 'bg-blue-600');
        step2Dot.classList.add('bg-gray-300');
        step2Dot.classList.remove('bg-blue-600');
    } else {
        requestForm.classList.add('hidden');
        resetForm.classList.remove('hidden');
        step1Dot.classList.add('bg-blue-600');
        step2Dot.classList.remove('bg-gray-300');
        step2Dot.classList.add('bg-blue-600');
    }
    clearNotification();
}

function initByToken() {
    const qp = getQueryParams();
    resetToken = qp.token || null;
    if (resetToken) {
        if (resetToken.toLowerCase() === 'expired') {
            setView('request');
            showNotification('Your password reset link has expired. Please request a new one.', 'error');
        } else {
            setView('reset');
            showNotification('Token verified. You can now set a new password.', 'success');
        }
    } else {
        setView('request');
    }
}

// Request form submit
requestForm.addEventListener('submit', function(e) {
    e.preventDefault();
    clearNotification();
    const email = emailInput.value.trim();
    if (!email || !validateEmail(email)) {
        showNotification('Please enter a valid email address (e.g., user@example.com).', 'error');
        emailInput.focus();
        return;
    }
    setLoading(sendLinkBtn, true);
    isLoading = true;
    // Simulate API call
    setTimeout(() => {
        isLoading = false;
        setLoading(sendLinkBtn, false);
        // Mock: if email contains 'unknown', show error
        if (email.toLowerCase().includes('unknown')) {
            showNotification('We couldn\'t find an account with that email address.', 'error');
            Swal.fire({
                icon: 'error',
                title: 'Email not found',
                text: 'Please check and try again, or register a new account.'
            });
        } else {
            showNotification('If an account exists for this email, a reset link has been sent. Please check your inbox.', 'success');
            Swal.fire({
                icon: 'success',
                title: 'Link Sent',
                text: 'Please check your email for the password reset link.'
            });
        }
    }, 1200);
});

// Reset form dynamic validation
function evaluateMatch() {
    const pwd = newPassword.value;
    const conf = confirmPassword.value;
    const score = passwordComplexityScore(pwd);
    updateStrengthBar(score);
    if (!pwd && !conf) {
        matchText.textContent = '';
        matchText.className = 'text-sm mt-1';
    } else if (conf && pwd !== conf) {
        matchText.textContent = 'Passwords do not match yet.';
        matchText.className = 'text-sm mt-1 text-red-600';
    } else if (pwd && conf && pwd === conf) {
        matchText.textContent = 'Passwords match.';
        matchText.className = 'text-sm mt-1 text-green-600';
    }
    const valid = score >= 4 && pwd === conf && pwd.length >= 8;
    resetPwdBtn.disabled = !valid || isLoading;
}

newPassword.addEventListener('input', evaluateMatch);
confirmPassword.addEventListener('input', evaluateMatch);

// Toggle password visibility
function toggleVisibility(btn, inputEl) {
    const icon = btn.querySelector('i');
    if (inputEl.type === 'password') {
        inputEl.type = 'text';
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
    } else {
        inputEl.type = 'password';
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
    }
}
toggleNewPwd.addEventListener('click', () => toggleVisibility(toggleNewPwd, newPassword));
toggleConfirmPwd.addEventListener('click', () => toggleVisibility(toggleConfirmPwd, confirmPassword));

// Reset form submit
resetForm.addEventListener('submit', function(e) {
    e.preventDefault();
    clearNotification();
    const pwd = newPassword.value.trim();
    const conf = confirmPassword.value.trim();
    if (passwordComplexityScore(pwd) < 4) {
        showNotification('Please choose a stronger password that meets all requirements.', 'error');
        return;
    }
    if (pwd !== conf) {
        showNotification('Passwords do not match. Please confirm again.', 'error');
        return;
    }
    if (!resetToken) {
        showNotification('Missing or invalid reset token. Please request a new link.', 'error');
        return;
    }
    setLoading(resetPwdBtn, true);
    isLoading = true;
    // Simulate API call
    setTimeout(() => {
        isLoading = false;
        setLoading(resetPwdBtn, false);
        if (String(resetToken).toLowerCase() === 'expired') {
            showNotification('Your token has expired. Please request a new reset link.', 'error');
            Swal.fire({
                icon: 'error',
                title: 'Token expired',
                text: 'Please request a new password reset link.'
            });
            setView('request');
        } else {
            showNotification('Your password has been reset successfully. You can now login.', 'success');
            Swal.fire({
                icon: 'success',
                title: 'Password updated',
                html: 'Your password has been reset. <br/><br/>Proceed to <a href="./login_page.html" class="text-blue-600">Login</a>.',
                confirmButtonText: 'Done'
            });
        }
    }, 1400);
});

// Help Assistant toggle
function toggleHelp() {
    const active = helpPanel.classList.toggle('active');
    helpPanel.classList.toggle('hidden', !active);
}
helpPanel.classList.remove('hidden'); // start hidden via CSS transition class only
helpPanel.classList.remove('active');
helpPanel.classList.add('hidden');
helpToggle.addEventListener('click', () => {
    if (helpPanel.classList.contains('hidden')) {
        helpPanel.classList.remove('hidden');
        requestAnimationFrame(() => helpPanel.classList.add('active'));
    } else {
        helpPanel.classList.remove('active');
        setTimeout(() => helpPanel.classList.add('hidden'), 220);
    }
});

// Notification panel toggle
notifyPanel.classList.remove('active');
notifyToggle.addEventListener('click', () => {
    const expanded = notifyPanel.classList.toggle('active');
    notifyToggle.setAttribute('aria-expanded', expanded ? 'true' : 'false');
});
closeNotify.addEventListener('click', () => {
    notifyPanel.classList.remove('active');
    notifyToggle.setAttribute('aria-expanded', 'false');
});

// Accessibility mode toggle
accessToggle.addEventListener('click', () => {
    const html = document.documentElement;
    const on = html.classList.toggle('accessible-mode');
    accessToggle.setAttribute('aria-pressed', on ? 'true' : 'false');
});

// Narrate instructions
function narrate(text) {
    try {
        window.speechSynthesis.cancel();
        const u = new SpeechSynthesisUtterance(text);
        u.rate = 1.0;
        u.pitch = 1.0;
        u.lang = 'en-US';
        window.speechSynthesis.speak(u);
    } catch (e) {
        /* fail silently */ }
}
narrateBtn.addEventListener('click', () => {
    const text = currentView === 'request' ?
        'You are on the password reset page. Enter your email address and press Send Reset Link. We will email a secure link to help you reset your password.' :
        'You are setting a new password. Enter a strong password of at least eight characters including an uppercase letter, a number, and a special character. Confirm the same password, then press Reset Password.';
    narrate(text);
});

// Initialize view based on token
initByToken();
// Initialize button state
resetPwdBtn.disabled = true;
  </script>
 </body>
</html>
